AWS.config.update({
    accessKeyId: 'ASIA3YCYNCYE5BW2WYMK',
    secretAccessKey: '5bPkJoH2KAEKEB2rw3DyanCHfIEEP7p6O3JtxkYR',
    sessionToken: 'FwoGZXIvYXdzEBYaDPkKB2O8u4sAl+vwbSLNAft4a2XL0LA5v5PDLG+7JlHGAxw7aFBzssXFezB1XLdcyiCop3Zk4Gjz8OBjnrmhJKmIc4pPy6e4aEI29WMyKtoczzIHKjn/hZwgL+ME18YahX3LGbBdjspbq5MBWOt49KiT1aPhuJ5T8dW0HWIfc1UdYPgWrDJpWAuYOhMWAmxoySSIUoGL70b+s4+9QkqJQp8ZrNJx/Sm7cwldYHMLbULLCtS8lcJjDidhp1x6QGeDw7lGOnITZ3AH+hGXUE000QfIOeBwlXn28E6rPnco3bvqgAYyLZivICAOuG0wx2grGXixLFWtuB8A0jinxKeVMjtcBtBRksiK+Y7FYF8luag2wg=='
});

AWS.config.region = 'us-east-1'; //region for where the server will be in
function uploadFile() { //Start of Upload method to S3 
    var s3 = new AWS.S3({
        params: {
            Bucket: 'cscassignment'
        } //Name of S3 bucket used 
    });
    var file = document.getElementById('file').files[0]; //get the file
    console.log(file)
    if (file) {
        s3.putObject({
                Key: file.name,
                ContentType: file.type,
                Body: file,
                ACL: "public-read"
            },
            function(err, data) {
                if (data !== null) {
                    alert("Upload succesful!"); //upload success
                } else {
                    alert("Upload failed!"); //upload failed
                }
            });
    }
}

var BucketName = 'cscassignment'; //Name of S3 bucket used 

function listObjs() { //Start of listing method
    var s3 = new AWS.S3({
        params: {
            Bucket: BucketName
        }
    });
    s3.listObjects(function(error, data) {
        if (error === null) {
            var html_urls = 'Short URLs (using bit.ly):<br />';
            var html_images = '';
            var longurl = "";
            var params = {
                "long_url": longurl
            };
            var accessToken = "3f5be8887873203d9e515699c43a412527151fe2"; //access token generated by bit.ly 
            jQuery.each(data.Contents, function(index, obj) {
                longurl = "https://s3.amazonaws.com/" + BucketName + "/" + obj.Key;
                params = {
                    "long_url": longurl
                };
                $.ajax({
                    url: "https://api-ssl.bitly.com/v4/shorten",
                    cache: false,
                    dataType: "json",
                    method: "POST",
                    contentType: "application/json",
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader("Authorization", "Bearer " + accessToken);
                    },
                    data: JSON.stringify(params)
                }).done(function(data) {
                    html_urls += (index + 1 + ': ' + obj.Key + ' Link = ' + JSON.parse(JSON.stringify(data)).link + '<br /> <br />');
                    console.log(html_urls);
                    jQuery("#objectUrl").html(html_urls);
                }).fail(function(data) {
                    console.log(data);
                });
                html_images += "<img src='" + "https://s3.amazonaws.com/" + BucketName + "/" + obj.Key + "'/><br/><br/>";
            });

            console.log('Loaded all items' + html_urls)
            jQuery("#objectImages").html(html_images);

        } else {
            console.log(error);
        }
    });
    //End of listing method
}